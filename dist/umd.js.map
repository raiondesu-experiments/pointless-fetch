{"version":3,"file":"umd.js","sources":["../src/util.ts","../src/merge.ts","../src/request.ts","../src/methods.ts","../src/suburl.ts","../src/fetch.ts","../src/query.ts"],"sourcesContent":["export const joinUrls = (...urls: Array<string | undefined>) => urls\n  .filter(_ => _)\n  .join('/')\n  .replace(\n    /^(?:\\w+:\\/\\/)?(.*\\/+.+)/g,\n    (_, $1) => _.replace($1, $1.replace(/\\/+/g, '/'))\n  );\n\nexport const isBase = (url: string) => /^(\\w+:\\/\\/.+|\\/\\/)/.test(url);\n","import { isBase, joinUrls } from './util';\n\nexport const defaultMerge = (v1: unknown, v2: unknown) => (\n  typeof v2 === 'undefined'\n    ? v1\n  : typeof v1 === 'undefined'\n    ? v2\n  : typeof v1 === typeof v2\n    ? Array.isArray(v1) && Array.isArray(v2)\n        ? v1.concat(v2)\n      : typeof v1 === 'object' && (!Array.isArray(v1) && !Array.isArray(v2))\n        ? { ...v1, ...v2 as object }\n    : v2\n  : v2\n);\n\nexport const mergeUrls = (url1: string, url2: string) => isBase(url2) ? url2 : joinUrls(url1, url2);\n\nexport function mergeHeaders(headers1?: HeadersInit, headers2?: HeadersInit) {\n  const h = new Headers(headers1);\n  const h2 = new Headers(headers2);\n\n  h2.forEach((v, k) => h.append(k, v));\n\n  return h;\n}\n","import { mergeHeaders, mergeUrls, defaultMerge } from './merge';\n\nexport type TRequest =\n  | RequestInit & { url: string };\n\nexport const request = ({ url, ...init }: TRequest) => new Request(url, init);\n\nexport const jsonBody = ({ body, ...stuff }: TRequest) => ({\n  ...stuff,\n  body: typeof body !== 'string' && typeof body !== 'undefined'\n    ? JSON.stringify(body)\n    : body,\n});\n\nexport type TCombiner = {\n  (r: TRequest, addon: TRequest): TRequest;\n} & {\n  -readonly[key in keyof TRequest]?: (value1: TRequest[key], value2: TRequest[key]) => TRequest[key];\n};\n\n/**\n * Combines two Request configs using special merge strategies for each field.\n *\n * Each merge strategy is stored in a property with the same name\n * as the corresponding Request property\n * and can be replaced at any time.\n */\nexport const combine: TCombiner = (req1: TRequest, req2: TRequest) => (\n  Object.keys(req1).concat(Object.keys(req2))\n  .reduce((res, key) => (\n    res[key] = (combine[key] || defaultMerge)(req1[key], req2[key]),\n    res\n  ), {} as TRequest)\n);\n\ncombine.headers = mergeHeaders;\ncombine.url = mergeUrls;\n","import { TRequest } from './request';\n\nexport type TRequestMethod =\n  | 'GET'\n  | 'HEAD'\n  | 'POST'\n  | 'PUT'\n  | 'DELETE'\n  | 'CONNECT'\n  | 'OPTIONS'\n  | 'TRAC';\n\nexport const method = (method: string) => (request: TRequest) => ({\n  ...request,\n  method,\n});\n\n/**\n * Sets request's method to `GET`.\n */\nexport const get = method('GET');\n\n/**\n * Sets request's method to `HEAD`.\n */\nexport const head = method('HEAD');\n\n/**\n * Sets request's method to `POST`.\n */\nexport const post = method('POST');\n\n/**\n * Sets request's method to `PUT`.\n */\nexport const put = method('PUT');\n\n/**\n * Sets request's method to `DELETE`.\n */\nexport const del = method('DELETE');\n\n/**\n * Sets request's method to `CONNECT`.\n */\nexport const connect = method('CONNECT');\n\n/**\n * Sets request's method to `OPTIONS`.\n */\nexport const options = method('OPTIONS');\n\n/**\n * Sets request's method to `TRAC`.\n */\nexport const trac = method('TRAC');\n","import { joinUrls } from './util';\n\nexport type TSubUrlFactory = string & {\n  (base: string): typeof subUrl;\n\n  <F extends (...args: any[]) => string>(\n    base: F\n  ): (\n    ...args: Parameters<F>\n  ) => typeof subUrl;\n\n  toString(): string;\n};\n\n/**\n * Creates a sub-url factory\n *\n * Example usage:\n *\n * ```ts\n *  const myBlog = subUrl('https://my-blog.com');\n *  // result:\n *  'https://my-blog.com'\n *\n *  const user = myBlog('user');\n *  // result:\n *  'https://my-blog.com/user'\n *\n *  const userPost = user((userId: number, postId: number) => `${userId}/post/${postId}`);\n *  // result:\n *  (userId: number, postId: number) => 'https://my-blog.com/user/${userId}/post/${postId}'\n * ```\n */\nexport const subUrl = <TSubUrlFactory> function (\n  this: { base?: string },\n  url: string | ((...args: any[]) => string)\n) {\n  const applyBase = (\n    _url: (...args: any[]) => string\n  ) => (...args: any[]) => {\n    const concat = () => joinUrls(this?.base, _url(...args));\n\n    const _subUrl = subUrl.bind({ base: concat() });\n    _subUrl.toString = concat;\n\n    return _subUrl;\n  };\n\n  return typeof url === 'string'\n    ? applyBase(() => url)()\n    : applyBase(url);\n};\n\nsubUrl.toString = () => '';\n","import { TRequest, combine, request } from './request';\n\nexport const createFetch = <T>(\n  req: TRequest,\n  after: (res: Response) => T | Promise<T>,\n  error?: (e: any) => never | T | Promise<T>\n) => (\n  finalRequest: TRequest = { url: '' }\n) => fetch(request(combine(req, finalRequest)))\n  .then(after)\n  .catch(error);\n","/**\n * Encodes an object into the plain URL as url-query-string\n *\n * ```js\n *  query('/list', {\n *    amount: 5,\n *    filters: ['price', 'date']\n *  })\n * ```\n *\n * returns\n * ```js\n *  '/list?amount=5&filters=price,date'\n * ```\n *\n * @param url a url to encode params into\n * @param queryParams query params in object form\n * @returns url with encoded params\n */\nexport const query = (url: string) => (queryParams: Record<PropertyKey, any>) => {\n  const query = Object.keys(queryParams)\n    .filter(k => k && queryParams[k] !== undefined)\n    .map((k): [string, string] =>\n      Array.isArray(queryParams[k])\n        ? [k, queryParams[k].join(',')]\n      : typeof queryParams[k] === 'object'\n        ? [k, JSON.stringify(queryParams[k])]\n      : [k, queryParams[k]]\n    )\n    .map(([key, value]) => `${encodeURIComponent(key)}=${encodeURI(value)}`)\n    .join('&');\n\n  const prefix = (String(url).indexOf('?') > -1 ? '&' : '?');\n\n  return url + (query.length > 0 ? prefix + query : '');\n};\n"],"names":["joinUrls","urls","filter","_","join","replace","$1","defaultMerge","v1","v2","_typeof","Array","isArray","concat","mergeUrls","url1","url2","test","mergeHeaders","headers1","headers2","h","Headers","forEach","v","k","append","request","url","init","Request","combine","req1","req2","Object","keys","reduce","res","key","headers","method","get","head","post","put","del","connect","options","trac","subUrl","applyBase","_url","args","_this","base","_subUrl","bind","toString","req","after","error","finalRequest","fetch","then","body","stuff","JSON","stringify","queryParams","query","undefined","map","value","encodeURIComponent","encodeURI","prefix","String","indexOf","length"],"mappings":"qxCAAO,IAAMA,EAAW,sCAAIC,2BAAAA,yBAAoCA,EAC7DC,OAAO,SAAAC,UAAKA,IACZC,KAAK,KACLC,QACC,2BACA,SAACF,EAAGG,UAAOH,EAAEE,QAAQC,EAAIA,EAAGD,QAAQ,OAAQ,SCHnCE,EAAe,SAACC,EAAaC,eAC1B,IAAPA,EACHD,OACY,IAAPA,EACLC,EACFC,EAAOF,OAAcC,GACnBE,MAAMC,QAAQJ,IAAOG,MAAMC,QAAQH,GAC/BD,EAAGK,OAAOJ,GACE,WAAdC,EAAOF,IAAqBG,MAAMC,QAAQJ,IAAQG,MAAMC,QAAQH,GAElEA,mBADSD,KAAOC,GAElBA,GAGSK,EAAY,SAACC,EAAcC,SDRD,qBAAqBC,KCQID,GAAQA,EAAOhB,EAASe,EAAMC,aAE9EE,EAAaC,EAAwBC,OAC7CC,EAAI,IAAIC,QAAQH,UACX,IAAIG,QAAQF,GAEpBG,QAAQ,SAACC,EAAGC,UAAMJ,EAAEK,OAAOD,EAAGD,KAE1BH,MCnBIM,EAAU,gBAAGC,IAAAA,IAAQC,sBAAqB,IAAIC,QAAQF,EAAKC,IAsB3DE,EAAqB,SAArBA,EAAsBC,EAAgBC,UACjDC,OAAOC,KAAKH,GAAMnB,OAAOqB,OAAOC,KAAKF,IACpCG,OAAO,SAACC,EAAKC,UACZD,EAAIC,IAAQP,EAAQO,IAAQ/B,GAAcyB,EAAKM,GAAML,EAAKK,IAC1DD,GACC,KAGLN,EAAQQ,QAAUrB,EAClBa,EAAQH,IAAMd,MCxBD0B,EAAS,SAACA,UAAmB,SAACb,2BACtCA,GACHa,OAAAA,MAMWC,EAAMD,EAAO,OAKbE,EAAOF,EAAO,QAKdG,EAAOH,EAAO,QAKdI,EAAMJ,EAAO,OAKbK,EAAML,EAAO,UAKbM,EAAUN,EAAO,WAKjBO,EAAUP,EAAO,WAKjBQ,EAAOR,EAAO,QCtBdS,EAA0B,SAA1BA,EAEXrB,cAEMsB,EAAY,SAChBC,UACG,sCAAIC,2BAAAA,sBACDvC,EAAS,wBAAMb,YAASqD,wBAAMC,KAAMH,eAAQC,KAE5CG,EAAUN,EAAOO,KAAK,CAAEF,KAAMzC,aACpC0C,EAAQE,SAAW5C,EAEZ0C,UAGa,iBAAR3B,EACVsB,EAAU,kBAAMtB,GAAhBsB,GACAA,EAAUtB,IAGhBqB,EAAOQ,SAAW,iBAAM,0CCnDG,SACzBC,EACAC,EACAC,UACG,eACHC,yDAAyB,CAAEjC,IAAK,WAC7BkC,MAAMnC,EAAQI,EAAQ2B,EAAKG,KAC7BE,KAAKJ,SACCC,0DHHe,gBAAGI,IAAAA,KAASC,wCAC/BA,GACHD,KAAsB,iBAATA,QAAqC,IAATA,EACrCE,KAAKC,UAAUH,GACfA,oFIQe,SAACpC,UAAgB,SAACwC,OAC/BC,EAAQnC,OAAOC,KAAKiC,GACvBlE,OAAO,SAAAuB,UAAKA,QAAwB6C,IAAnBF,EAAY3C,KAC7B8C,IAAI,SAAC9C,UACJd,MAAMC,QAAQwD,EAAY3C,IACtB,CAACA,EAAG2C,EAAY3C,GAAGrB,KAAK,MACA,WAA1BM,EAAO0D,EAAY3C,IACjB,CAACA,EAAGyC,KAAKC,UAAUC,EAAY3C,KACjC,CAACA,EAAG2C,EAAY3C,MAEnB8C,IAAI,yBAAEjC,OAAKkC,uBAAcC,mBAAmBnC,eAAQoC,UAAUF,MAC9DpE,KAAK,KAEFuE,EAAUC,OAAOhD,GAAKiD,QAAQ,MAAQ,EAAI,IAAM,WAE/CjD,GAAOyC,EAAMS,OAAS,EAAIH,EAASN,EAAQ"}